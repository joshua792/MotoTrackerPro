<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moto Race Setup Tracker</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <div class="header" style="position: relative;">
            <h1>Race Setup Tracker</h1>
            <p>Track your motorcycle setup changes throughout race weekend</p>
            <div style="position: absolute; top: 20px; right: 30px;">
                <div id="auth-header" style="display: none;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span id="user-welcome" style="color: #666;"></span>
                        <div id="subscription-status" style="font-size: 11px; padding: 2px 6px; border-radius: 3px; color: white;">
                            <!-- Subscription status will be filled by JavaScript -->
                        </div>
                        <button class="btn btn-secondary btn-small" onclick="showSubscriptionModal()">Subscription</button>
                        <button class="btn btn-secondary btn-small" onclick="showSettingsModal()">Settings</button>
                        <button class="btn btn-secondary btn-small" onclick="logout()">Logout</button>
                    </div>
                </div>
                <div id="login-header">
                    <button class="btn btn-primary btn-small" onclick="showAuthModal('login')">Login</button>
                    <button class="btn btn-secondary btn-small" onclick="showAuthModal('register')" style="margin-left: 5px;">Register</button>
                </div>
            </div>
        </div>

        <!-- Welcome message for unauthenticated users -->
        <div id="welcome-message" style="display: none; text-align: center; padding: 60px 20px; max-width: 600px; margin: 0 auto;">
            <h1 style="color: #2c5aa0; margin-bottom: 20px;">Welcome to MotoSetup Pro</h1>
            <p style="font-size: 18px; color: #666; margin-bottom: 30px;">
                Professional motorcycle race setup tracking and analysis tool for riders and teams.
            </p>
            <p style="color: #888; margin-bottom: 30px;">
                Track your motorcycle setups, analyze session data, and optimize your performance across different tracks and conditions.
            </p>
            <div style="margin-top: 40px;">
                <button class="btn btn-primary" onclick="showAuthModal('login')" style="margin-right: 10px; padding: 12px 24px; font-size: 16px;">Login to Your Account</button>
                <button class="btn btn-secondary" onclick="showAuthModal('register')" style="padding: 12px 24px; font-size: 16px;">Create New Account</button>
            </div>
        </div>

        <!-- App Content - Hidden when not authenticated -->
        <div id="app-content" style="display: none;">
            <!-- Weather Section - Moved to top -->
            <div class="weather-header">
                <div id="weather-display" style="display: none;">
                    <div class="weather-grid">
                        <div><strong>Temp:</strong> <span id="weather-temp">--</span></div>
                        <div><strong>Condition:</strong> <span id="weather-condition">--</span></div>
                        <div><strong>Humidity:</strong> <span id="weather-humidity">--</span></div>
                        <div><strong>Wind:</strong> <span id="weather-wind">--</span></div>
                    </div>
                    <div class="weather-time">
                        Last updated: <span id="weather-time">--</span>
                    </div>
                </div>
                <button class="btn btn-secondary btn-small" onclick="captureWeather()" id="capture-weather-btn">Capture Weather</button>
            </div>

            <div class="top-controls">
            <div class="left-panel">
                <!-- Event Section -->
                <div class="event-section">
                    <div class="section-header">
                        <span class="section-title">Event</span>
                    </div>
                    <div class="form-group">
                        <label for="series-select">Race Series</label>
                        <select id="series-select">
                            <option value="">Select Series...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="event-select">Select Event</label>
                        <select id="event-select">
                            <option value="">Loading events...</option>
                        </select>
                    </div>
                </div>

                <!-- Motorcycle Selection -->
                <div class="motorcycle-section">
                    <div class="section-header">
                        <span class="section-title">Motorcycles</span>
                        <button class="btn btn-secondary btn-small" onclick="showSettingsModal(); showSettingsTab('motorcycles');">Manage</button>
                    </div>
                    <div id="motorcycle-list" class="motorcycle-grid">
                        <div class="empty-state">
                            <h3>No motorcycles added</h3>
                            <p>Go to Settings → Motorcycles to add motorcycles</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Track Map Section -->
            <div class="track-map-section">
                <div class="section-header">
                    <span class="section-title">Track Map</span>
                </div>
                <div id="track-map-container">
                    <div class="track-map-placeholder">
                        <p>Select an event to view track map</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="main-content" style="display: none;">
            <div class="session-tabs">
                <button class="session-tab active" onclick="switchSession('practice1')">Practice 1</button>
                <button class="session-tab" onclick="switchSession('qualifying1')">Qualifying 1</button>
                <button class="session-tab" onclick="switchSession('qualifying2')">Qualifying 2</button>
                <button class="session-tab" onclick="switchSession('race1')">Race 1</button>
                <button class="session-tab" onclick="switchSession('warmup')">Warmup</button>
                <button class="session-tab" onclick="switchSession('race2')">Race 2</button>
            </div>

            <div class="session-content">
                <!-- Collapsible Setup Section -->
                <button class="collapsible active" onclick="toggleCollapsible(this)">
                    <span class="collapsible-icon">−</span>
                    Setup Configuration
                </button>
                <div class="collapsible-content" style="display: block;">
                    <div class="setup-grid">
                        <div class="setup-section">
                            <h3>Front</h3>
                            <div class="setup-fields">
                                <div class="input-group">
                                    <label>Spring Rate:</label>
                                    <div class="number-input-container">
                                        <button class="increment-btn" onclick="changeValue('front-spring', -0.5, 5.0, 15.0, 0.5)">−</button>
                                        <input type="number" id="front-spring" class="number-input" min="5.0" max="15.0" step="0.5" placeholder="5.0">
                                        <button class="increment-btn" onclick="changeValue('front-spring', 0.5, 5.0, 15.0, 0.5)">+</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Preload (mm):</label>
                                    <div class="number-input-container">
                                        <button class="increment-btn" onclick="changeValue('front-preload', -1, 0, 20, 1)">−</button>
                                        <input type="number" id="front-preload" class="number-input" min="0" max="20" step="1" placeholder="0">
                                        <button class="increment-btn" onclick="changeValue('front-preload', 1, 0, 20, 1)">+</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Compression:</label>
                                    <div class="number-input-container">
                                        <button class="increment-btn" onclick="changeValue('front-compression', -1, 0, 50, 1)">−</button>
                                        <input type="number" id="front-compression" class="number-input" min="0" max="50" step="1" placeholder="0">
                                        <button class="increment-btn" onclick="changeValue('front-compression', 1, 0, 50, 1)">+</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Rebound:</label>
                                    <div class="number-input-container">
                                        <button class="increment-btn" onclick="changeValue('front-rebound', -1, 0, 50, 1)">−</button>
                                        <input type="number" id="front-rebound" class="number-input" min="0" max="50" step="1" placeholder="0">
                                        <button class="increment-btn" onclick="changeValue('front-rebound', 1, 0, 50, 1)">+</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Tire:</label>
                                    <div class="tire-management">
                                        <select id="front-tire">
                                            <option value="">Loading tires...</option>
                                        </select>
                                        <button class="manage-btn" onclick="showTireModal()">Manage</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>PSI:</label>
                                    <div class="number-input-container">
                                        <button class="increment-btn" onclick="changeValue('front-pressure', -0.1, 15, 40, 0.1)">−</button>
                                        <input type="number" id="front-pressure" class="number-input" min="15" max="40" step="0.1" placeholder="15.0">
                                        <button class="increment-btn" onclick="changeValue('front-pressure', 0.1, 15, 40, 0.1)">+</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Front Sprocket:</label>
                                    <div class="number-input-container">
                                        <button class="increment-btn" onclick="changeValue('front-sprocket', -1, 10, 20, 1)">−</button>
                                        <input type="number" id="front-sprocket" class="number-input" min="10" max="20" step="1" placeholder="10">
                                        <button class="increment-btn" onclick="changeValue('front-sprocket', 1, 10, 20, 1)">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="setup-section">
                            <h3>Rear</h3>
                            <div class="setup-fields">
                                <div class="input-group">
                                    <label>Spring Rate:</label>
                                    <div class="number-input-container">
                                        <button class="increment-btn" onclick="changeValue('rear-spring', -0.5, 5.0, 15.0, 0.5)">−</button>
                                        <input type="number" id="rear-spring" class="number-input" min="5.0" max="15.0" step="0.5" placeholder="5.0">
                                        <button class="increment-btn" onclick="changeValue('rear-spring', 0.5, 5.0, 15.0, 0.5)">+</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Preload (mm):</label>
                                    <div class="number-input-container">
                                        <button class="increment-btn" onclick="changeValue('rear-preload', -1, 0, 20, 1)">−</button>
                                        <input type="number" id="rear-preload" class="number-input" min="0" max="20" step="1" placeholder="0">
                                        <button class="increment-btn" onclick="changeValue('rear-preload', 1, 0, 20, 1)">+</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Compression:</label>
                                    <div class="number-input-container">
                                        <button class="increment-btn" onclick="changeValue('rear-compression', -1, 0, 50, 1)">−</button>
                                        <input type="number" id="rear-compression" class="number-input" min="0" max="50" step="1" placeholder="0">
                                        <button class="increment-btn" onclick="changeValue('rear-compression', 1, 0, 50, 1)">+</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Rebound:</label>
                                    <div class="number-input-container">
                                        <button class="increment-btn" onclick="changeValue('rear-rebound', -1, 0, 50, 1)">−</button>
                                        <input type="number" id="rear-rebound" class="number-input" min="0" max="50" step="1" placeholder="0">
                                        <button class="increment-btn" onclick="changeValue('rear-rebound', 1, 0, 50, 1)">+</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Tire:</label>
                                    <div class="tire-management">
                                        <select id="rear-tire">
                                            <option value="">Loading tires...</option>
                                        </select>
                                        <button class="manage-btn" onclick="showTireModal()">Manage</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>PSI:</label>
                                    <div class="number-input-container">
                                        <button class="increment-btn" onclick="changeValue('rear-pressure', -0.1, 15, 40, 0.1)">−</button>
                                        <input type="number" id="rear-pressure" class="number-input" min="15" max="40" step="0.1" placeholder="15.0">
                                        <button class="increment-btn" onclick="changeValue('rear-pressure', 0.1, 15, 40, 0.1)">+</button>
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Rear Sprocket:</label>
                                    <div class="number-input-container">
                                        <button class="increment-btn" onclick="changeValue('rear-sprocket', -1, 30, 60, 1)">−</button>
                                        <input type="number" id="rear-sprocket" class="number-input" min="30" max="60" step="1" placeholder="30">
                                        <button class="increment-btn" onclick="changeValue('rear-sprocket', 1, 30, 60, 1)">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="collapsible" onclick="toggleCollapsible(this)">
                        <span class="collapsible-icon">+</span>
                        Suspension Geometry
                    </button>
                    <div class="collapsible-content">
                        <div class="setup-grid">
                            <div class="setup-section">
                                <h3>Front Geometry</h3>
                                <div class="setup-fields">
                                    <div class="input-group">
                                        <label>Ride Height (mm):</label>
                                        <input type="number" id="front-ride-height" placeholder="Front ride height" style="width: 100px;">
                                    </div>
                                    <div class="input-group">
                                        <label>Sag (mm):</label>
                                        <input type="number" id="front-sag" placeholder="Front sag" style="width: 100px;">
                                    </div>
                                    <div class="input-group">
                                        <label>Rake:</label>
                                        <input type="text" id="rake" placeholder="Rake angle" style="width: 100px;">
                                    </div>
                                    <div class="input-group">
                                        <label>Trail:</label>
                                        <input type="text" id="trail" placeholder="Trail measurement" style="width: 100px;">
                                    </div>
                                </div>
                            </div>
                            <div class="setup-section">
                                <h3>Rear Geometry</h3>
                                <div class="setup-fields">
                                    <div class="input-group">
                                        <label>Ride Height (mm):</label>
                                        <input type="number" id="rear-ride-height" placeholder="Rear ride height" style="width: 100px;">
                                    </div>
                                    <div class="input-group">
                                        <label>Sag (mm):</label>
                                        <input type="number" id="rear-sag" placeholder="Rear sag" style="width: 100px;">
                                    </div>
                                    <div class="input-group">
                                        <label>Swingarm Angle:</label>
                                        <input type="text" id="swingarm-angle" placeholder="Swingarm angle" style="width: 100px;">
                                    </div>
                                    <div class="input-group">
                                        <label>Swingarm Length (mm):</label>
                                        <input type="number" id="swingarm-length" min="1" step="1" placeholder="Length in mm" style="width: 100px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="notes-section">
                    <div class="form-group">
                        <label for="notes">Setup Notes</label>
                        <textarea id="notes" placeholder="Track conditions, setup changes, rider feedback..."></textarea>
                    </div>
                </div>

                <div class="feedback-section">
                    <h4>Post-Session Feedback</h4>
                    <textarea id="feedback" placeholder="How did the bike feel? What needs to be changed for the next session?"></textarea>
                </div>

                <div class="feedback-section" style="background: #f3e5f5; border-color: #9c27b0;">
                    <h4 style="color: #7b1fa2;">RaceStudio3 Data</h4>
                    <div class="form-group">
                        <label for="rs3-file">Upload RaceStudio3 CSV Export</label>
                        <input type="file" id="rs3-file" accept=".csv" onchange="handleFileUpload(event)">
                    </div>
                    <div id="file-status" style="margin-top: 10px; font-size: 12px; color: #666;"></div>
                    <div id="uploaded-files" style="margin-top: 10px;"></div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-success" onclick="saveSession()">Save Session</button>
                    <button class="btn btn-primary" onclick="copyFromPrevious()">Copy from Previous Session</button>
                    <button class="btn btn-secondary" onclick="clearSession()">Clear All</button>
                    <button class="btn btn-secondary" onclick="exportData()">Export Data</button>
                    <button class="btn btn-primary" onclick="sendToAI()">AI Analysis</button>
                </div>

                <div id="saved-data" class="data-display" style="display: none;">
                    <h4>Session Saved Successfully!</h4>
                    <p>Data has been saved to browser storage and is ready for analysis.</p>
                </div>
            </div>
        </div>
        </div> <!-- Close app-content wrapper -->

    <!-- Add Motorcycle Modal -->
    <div id="motorcycle-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddMotorcycleModal()">&times;</span>
            <div class="modal-header">Add New Motorcycle</div>

            <div class="form-group">
                <label for="new-make">Make</label>
                <select id="new-make">
                    <option value="">Select Make...</option>
                    <option value="Yamaha">Yamaha</option>
                    <option value="Honda">Honda</option>
                    <option value="Kawasaki">Kawasaki</option>
                    <option value="Suzuki">Suzuki</option>
                    <option value="Ducati">Ducati</option>
                    <option value="BMW">BMW</option>
                    <option value="Aprilia">Aprilia</option>
                    <option value="KTM">KTM</option>
                    <option value="Kramer">Kramer</option>
                </select>
            </div>

            <div class="form-group">
                <label for="new-model">Model</label>
                <input type="text" id="new-model" placeholder="R1, CBR1000RR, ZX-10R, etc.">
            </div>

            <div class="form-group">
                <label for="new-class">Class</label>
                <select id="new-class">
                    <option value="">Select Class...</option>
                    <option value="Superbike">Superbike</option>
                    <option value="Stock 1000">Stock 1000</option>
                    <option value="Supersport">Supersport</option>
                    <option value="Twins Cup">Twins Cup</option>
                    <option value="Talent Cup">Talent Cup</option>
                    <option value="Mini Cup">Mini Cup</option>
                </select>
            </div>

            <div class="form-group">
                <label for="new-number">Rider Number</label>
                <input type="text" id="new-number" placeholder="69">
            </div>

            <div class="form-group">
                <label for="new-variant">Bike</label>
                <select id="new-variant">
                    <option value="A">A Bike</option>
                    <option value="B">B Bike</option>
                </select>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="addMotorcycle()">Add Motorcycle</button>
                <button class="btn btn-secondary" onclick="closeAddMotorcycleModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <span class="close" onclick="closeSettingsModal()">&times;</span>
            <div class="modal-header">Settings</div>

            <div style="border-bottom: 1px solid #ddd; margin-bottom: 20px;">
                <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                    <button class="btn btn-secondary" onclick="showSettingsTab('units')" id="units-tab">Units</button>
                    <button class="btn btn-secondary" onclick="showSettingsTab('events')" id="events-tab">Events</button>
                    <button class="btn btn-secondary" onclick="showSettingsTab('motorcycles')" id="motorcycles-tab">Motorcycles</button>
                    <button class="btn btn-secondary" onclick="showSettingsTab('account')" id="account-tab">Account</button>
                    <button class="btn btn-secondary" onclick="showSettingsTab('admin')" id="admin-tab" style="display: none;">Admin</button>
                </div>
            </div>

            <!-- Units Tab -->
            <div id="units-settings" class="settings-tab">
                <h3>Unit Preferences</h3>
                <div class="form-group">
                    <label for="pressure-unit">Tire Pressure</label>
                    <select id="pressure-unit">
                        <option value="psi">PSI</option>
                        <option value="bar">Bar</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="temperature-unit">Temperature</label>
                    <select id="temperature-unit">
                        <option value="fahrenheit">Fahrenheit (°F)</option>
                        <option value="celsius">Celsius (°C)</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="saveUnitSettings()">Save Units</button>
            </div>

            <!-- Events Tab -->
            <div id="events-settings" class="settings-tab" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Event Management</h3>
                    <button class="btn btn-primary btn-small" onclick="showAddEventModal()">+ Add Event</button>
                </div>
                <div id="events-list" style="max-height: 400px; overflow-y: auto;">
                    Loading events...
                </div>
            </div>

            <!-- Motorcycles Tab -->
            <div id="motorcycles-settings" class="settings-tab" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Motorcycle Management</h3>
                    <button class="btn btn-primary btn-small" onclick="showAddMotorcycleModal()">+ Add Motorcycle</button>
                </div>
                <div id="motorcycles-settings-list" style="max-height: 400px; overflow-y: auto;">
                    Loading motorcycles...
                </div>
            </div>

            <!-- Account Tab -->
            <div id="account-settings" class="settings-tab" style="display: none;">
                <h3>Account Information</h3>
                <div class="form-group">
                    <label for="user-name">Name</label>
                    <input type="text" id="user-name" placeholder="Your name">
                </div>
                <div class="form-group">
                    <label for="user-email">Email</label>
                    <input type="email" id="user-email" placeholder="your@email.com" readonly style="background-color: #f9f9f9;">
                    <small style="color: #666; font-size: 12px;">Email cannot be changed (used for login)</small>
                </div>
                <div class="form-group">
                    <label for="user-team">Team</label>
                    <input type="text" id="user-team" placeholder="Team name">
                </div>
                <div class="form-group">
                    <label for="user-race-series">Race Series</label>
                    <select id="user-race-series" multiple style="height: 120px; width: 100%;">
                        <option value="MotoAmerica">MotoAmerica</option>
                        <option value="WERA">WERA</option>
                        <option value="CRA">CRA</option>
                        <option value="OMRRA">OMRRA</option>
                        <option value="AMA">AMA</option>
                        <option value="FIM">FIM</option>
                        <option value="BSB">British Superbike</option>
                        <option value="IDM">IDM</option>
                        <option value="CSBK">CSBK</option>
                        <option value="Local Track Day">Local Track Day</option>
                        <option value="Private Test">Private Test</option>
                    </select>
                    <small style="color: #666; font-size: 12px;">Hold Ctrl/Cmd to select multiple series</small>
                </div>

                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="saveAccountSettings()">Save Account Info</button>
                </div>

                <hr style="margin: 30px 0; border: 1px solid #ddd;">

                <h3>Change Password</h3>
                <div class="form-group">
                    <label for="current-password">Current Password</label>
                    <input type="password" id="current-password" placeholder="Enter current password">
                </div>
                <div class="form-group">
                    <label for="new-password">New Password</label>
                    <input type="password" id="new-password" placeholder="Enter new password (min 8 characters)">
                </div>
                <div class="form-group">
                    <label for="confirm-new-password">Confirm New Password</label>
                    <input type="password" id="confirm-new-password" placeholder="Confirm new password">
                </div>

                <div style="margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="changePassword()">Change Password</button>
                </div>
            </div>

            <!-- Admin Tab -->
            <div id="admin-settings" class="settings-tab" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Admin Panel</h3>
                    <div id="admin-switched-notice" style="display: none; color: #d63384; font-weight: bold; font-size: 12px;">
                        ADMIN MODE: Viewing as different user
                        <button class="btn btn-small" onclick="switchBackToAdmin()" style="margin-left: 10px;">Switch Back</button>
                    </div>
                </div>

                <div style="border-bottom: 1px solid #ddd; margin-bottom: 20px;">
                    <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                        <button class="btn btn-secondary" onclick="showAdminSection('users')" id="admin-users-tab">Users</button>
                        <button class="btn btn-secondary" onclick="showAdminSection('tracks')" id="admin-tracks-tab">Tracks</button>
                    </div>
                </div>

                <!-- Users Section -->
                <div id="admin-users-section">
                    <h4>User Management</h4>
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-secondary" onclick="loadUsersList()">Refresh Users List</button>
                    </div>

                    <div id="users-list" style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;">
                        <p>Click "Refresh Users List" to load users</p>
                    </div>
                </div>

                <!-- Tracks Section -->
                <div id="admin-tracks-section" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h4>Track Management</h4>
                        <button class="btn btn-primary btn-small" onclick="showAddTrackModal()">+ Add Track</button>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-secondary" onclick="loadTracksList()">Refresh Tracks List</button>
                    </div>

                    <div id="tracks-list" style="max-height: 400px; overflow-y: auto; border: 1px solid #ddd; padding: 10px;">
                        <p>Click "Refresh Tracks List" to load tracks</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div id="add-event-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddEventModal()">&times;</span>
            <div class="modal-header" id="event-modal-title">Add New Event</div>

            <div class="form-group">
                <label for="event-series">Race Series</label>
                <select id="event-series">
                    <option value="">Select Series...</option>
                </select>
                <small style="color: #666; font-size: 12px;">Configure your race series in Account Settings</small>
            </div>

            <div class="form-group">
                <label for="event-name">Event Name</label>
                <input type="text" id="event-name" placeholder="e.g., WERA at Putnam Park">
            </div>

            <div class="form-group">
                <label for="event-track">Track</label>
                <select id="event-track">
                    <option value="">Select Track...</option>
                </select>
                <small style="color: #666; font-size: 12px;">Tracks are managed by admins. Contact admin if track is missing.</small>
            </div>

            <div class="form-group">
                <label for="event-date">Weekend Start Date</label>
                <input type="date" id="event-date" onchange="updateEventDateRange()">
                <small style="color: #666; font-size: 12px;">End date will be automatically set to Sunday</small>
            </div>

            <div class="form-group">
                <label for="event-date-display">Event Date Range</label>
                <input type="text" id="event-date-display" readonly style="background: #f8f9fa;" placeholder="Select start date to see range">
            </div>

            <div class="form-group">
                <label for="event-location">Location</label>
                <input type="text" id="event-location" placeholder="e.g., Mt. Meridian, IN">
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="saveEventData()" id="save-event-btn">Add Event</button>
                <button class="btn btn-secondary" onclick="closeAddEventModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Tire Modal -->
    <div id="tire-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeTireModal()">&times;</span>
            <div class="modal-header">Manage Tires</div>

            <div class="form-group">
                <label for="tire-brand">Brand</label>
                <select id="tire-brand">
                    <option value="Dunlop">Dunlop</option>
                    <option value="Pirelli">Pirelli</option>
                    <option value="Bridgestone">Bridgestone</option>
                    <option value="Michelin">Michelin</option>
                </select>
            </div>

            <div class="form-group">
                <label for="tire-type">Type</label>
                <select id="tire-type">
                    <option value="Slick">Slick</option>
                    <option value="Wet">Wet</option>
                    <option value="Intermediate">Intermediate</option>
                </select>
            </div>

            <div class="form-group">
                <label for="tire-size">Size</label>
                <input type="text" id="tire-size" placeholder="120/70-17 & 200/55-17">
            </div>

            <div class="form-group">
                <label for="tire-compound">Compound</label>
                <input type="text" id="tire-compound" placeholder="Medium, Soft, Hard, etc.">
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="addTire()">Add Tire</button>
                <button class="btn btn-secondary" onclick="closeTireModal()">Close</button>
            </div>

            <div id="tire-list" style="margin-top: 20px;">
                <h4>Current Tires:</h4>
                <div id="tire-display">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close" onclick="closeAuthModal()">&times;</span>

            <!-- Login Form -->
            <div id="login-form">
                <div class="modal-header">Login</div>
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="Password" required>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="login()" style="width: 100%;">Login</button>
                </div>
                <div class="form-group" style="text-align: center;">
                    <a href="#" onclick="showAuthModal('register')" style="color: #2c5aa0; text-decoration: none;">Don't have an account? Register</a><br>
                    <a href="#" onclick="showAuthModal('reset')" style="color: #2c5aa0; text-decoration: none; font-size: 12px;">Forgot Password?</a>
                </div>
            </div>

            <!-- Register Form -->
            <div id="register-form" style="display: none;">
                <div class="modal-header">Create Account</div>
                <div class="form-group">
                    <label for="register-name">Full Name</label>
                    <input type="text" id="register-name" placeholder="Your full name" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" placeholder="Password (min 8 characters)" required>
                </div>
                <div class="form-group">
                    <label for="register-confirm-password">Confirm Password</label>
                    <input type="password" id="register-confirm-password" placeholder="Confirm password" required>
                </div>
                <div class="form-group">
                    <label for="register-team">Team (Optional)</label>
                    <input type="text" id="register-team" placeholder="Your racing team">
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="register()" style="width: 100%;">Create Account</button>
                </div>
                <div class="form-group" style="text-align: center;">
                    <a href="#" onclick="showAuthModal('login')" style="color: #2c5aa0; text-decoration: none;">Already have an account? Login</a>
                </div>
            </div>

            <!-- Password Reset Form -->
            <div id="reset-form" style="display: none;">
                <div class="modal-header">Reset Password</div>
                <div class="form-group">
                    <label for="reset-email">Email</label>
                    <input type="email" id="reset-email" placeholder="Enter your email address" required>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="resetPassword()" style="width: 100%;">Send Reset Instructions</button>
                </div>
                <div class="form-group" style="text-align: center;">
                    <a href="#" onclick="showAuthModal('login')" style="color: #2c5aa0; text-decoration: none;">Back to Login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Track Modal -->
    <div id="track-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" onclick="closeTrackModal()">&times;</span>
            <div class="modal-header" id="track-modal-title">Add New Track</div>

            <div class="form-group">
                <label for="track-name">Track Name *</label>
                <input type="text" id="track-name" placeholder="Circuit of the Americas" required>
            </div>

            <div class="form-group">
                <label for="track-location">Location *</label>
                <input type="text" id="track-location" placeholder="Austin, Texas" required>
            </div>

            <div class="form-group">
                <label for="track-country">Country</label>
                <input type="text" id="track-country" placeholder="United States">
            </div>

            <div class="form-group">
                <label for="track-description">Description</label>
                <textarea id="track-description" placeholder="Track description and notes" rows="3"></textarea>
            </div>

            <div style="display: flex; gap: 15px;">
                <div class="form-group" style="flex: 1;">
                    <label for="track-length-miles">Length (Miles)</label>
                    <input type="number" id="track-length-miles" step="0.01" placeholder="3.41">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label for="track-length-km">Length (KM)</label>
                    <input type="number" id="track-length-km" step="0.01" placeholder="5.49">
                </div>
            </div>

            <div style="display: flex; gap: 15px;">
                <div class="form-group" style="flex: 1;">
                    <label for="track-turns">Number of Turns</label>
                    <input type="number" id="track-turns" placeholder="20">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label for="track-direction">Direction</label>
                    <select id="track-direction">
                        <option value="clockwise">Clockwise</option>
                        <option value="counterclockwise">Counter-clockwise</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="track-map-upload">Track Map</label>
                <input type="file" id="track-map-upload" accept="image/*" onchange="handleTrackMapUpload(event)">
                <small style="color: #666; font-size: 12px;">Upload JPG, PNG, or GIF image</small>
                <div id="track-map-preview" style="margin-top: 10px; display: none;">
                    <img id="track-map-preview-img" style="max-width: 100%; max-height: 200px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
            </div>

            <div class="form-group">
                <button class="btn btn-primary" onclick="saveTrack()" id="save-track-btn">Add Track</button>
                <button class="btn btn-secondary" onclick="closeTrackModal()" style="margin-left: 10px;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Subscription Modal -->
    <div id="subscription-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" onclick="closeSubscriptionModal()">&times;</span>
            <div class="modal-header">Subscription Management</div>

            <div id="subscription-info" style="margin-bottom: 20px;">
                <!-- Subscription details will be loaded here -->
            </div>

            <div id="subscription-plans" style="display: none;">
                <h3 style="margin-bottom: 15px;">Available Plans</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="plan-card" style="border: 2px solid #ddd; border-radius: 8px; padding: 20px; text-align: center;">
                        <h4 style="color: #2c5aa0; margin-bottom: 10px;">Basic Plan</h4>
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">$9.99/month</div>
                        <ul style="text-align: left; margin-bottom: 15px; padding-left: 20px;">
                            <li>5,000 session saves per month</li>
                            <li>Track map access</li>
                            <li>Weather integration</li>
                            <li>Previous track data</li>
                            <li>Export capabilities</li>
                        </ul>
                        <button class="btn btn-primary" onclick="selectPlan('basic')" id="basic-plan-btn">Select Basic</button>
                    </div>
                    <div class="plan-card" style="border: 2px solid #2c5aa0; border-radius: 8px; padding: 20px; text-align: center;">
                        <h4 style="color: #2c5aa0; margin-bottom: 10px;">Premium Plan</h4>
                        <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">$19.99/month</div>
                        <ul style="text-align: left; margin-bottom: 15px; padding-left: 20px;">
                            <li>Unlimited session saves</li>
                            <li>Everything in Basic</li>
                            <li>Priority support</li>
                            <li>Advanced analytics</li>
                            <li>Team collaboration</li>
                        </ul>
                        <button class="btn btn-primary" onclick="selectPlan('premium')" id="premium-plan-btn">Select Premium</button>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <button class="btn btn-secondary" onclick="closeSubscriptionModal()">Close</button>
            </div>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/subscription.js"></script>
    <script src="js/weather.js"></script>
    <script src="js/motorcycles.js"></script>
    <script src="js/tracks.js"></script>
    <script src="js/events.js"></script>
    <script src="js/sessions.js"></script>
    <script src="js/app.js"></script>
</body>
</html>